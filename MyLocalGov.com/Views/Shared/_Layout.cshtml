<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Civic Connect</title>
    <link href="~/css/site-theme.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="~/css/Shared/navbar.css" rel="stylesheet" />

	<!-- AOS CSS -->
	<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

	<!-- Animation helper CSS -->
	<link href="~/css/Shared/animation-helper.css" rel="stylesheet">

	<!-- Page Spinner CSS -->
	<link href="~/css/Shared/page-spinner.css" rel="stylesheet">
    <style>
        .layout-container {
            background: linear-gradient(135deg, var(--primary-blue-dark), var(--primary-blue-medium), var(--primary-blue-light));
            min-height: 100vh;
            color: var(--white);
        }

        .layout-main {
            padding: var(--spacing-xl);
            background: var(--white-transparent-10);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-xl);
            border: 1px solid var(--white-transparent-20);
            box-shadow: var(--shadow-md);
        }

        .layout-footer {
            background: var(--black-transparent-20);
            border-top: 1px solid var(--white-transparent-20);
            color: var(--white-transparent-90);
            font-family: var(--font-family-primary);
            font-size: var(--font-size-sm);
            padding: var(--spacing-lg) 0;
            margin-top: var(--spacing-2xl);
        }

        .layout-footer a {
            color: var(--white-transparent-90);
            text-decoration: none;
            transition: color var(--transition-normal);
        }

        .layout-footer a:hover {
            color: var(--white);
        }

        /* Container: top padding only when navbar is visible */
        .custom-container {
			max-width: 80vw;
            margin: 0 auto;
			padding: 0 var(--spacing-lg);
        }

        .has-navbar .custom-container { 
			padding-top: 77px; 
		}

        @@media (max-width: 768px) { 
			.has-navbar .custom-container { 
				padding-top: 317px; 
			} 
		}

        /* When navbar is hidden, let page own the background/padding */
        .no-navbar .layout-main { 
			background: transparent; 
			border: 0; 
			box-shadow: none; 
			backdrop-filter: none; 
			-webkit-backdrop-filter: none; 
		}
    </style>
</head>

@{
    var controller = ViewContext.RouteData.Values["controller"]?.ToString() ?? string.Empty;
    var action = ViewContext.RouteData.Values["action"]?.ToString() ?? string.Empty;
    var routeKey = $"{controller}/{action}";
    var excludedRoutes = new HashSet<string>(StringComparer.OrdinalIgnoreCase)
    {
        // Add routes that should not show the navbar
        "Auth/Index",
        "Account/Login",
        "Account/Register"
    };
    var explicitHide = ViewData["HideNavbar"] is bool b && b;
    var hideNavbar = explicitHide || excludedRoutes.Contains(routeKey);
    var bodyClass = $"layout-container {(hideNavbar ? "no-navbar" : "has-navbar")} {(hideNavbar ? "landing-page-full-bg" : string.Empty)}";
}

<body class="@bodyClass body-anim-loading">
    <!-- Page Loading Overlay -->
    <div id="pageLoadingOverlay" class="page-loading-overlay">
      <div class="spinner-icon"></div>
    </div>

    <header>
        @if (!hideNavbar)
        {
        <nav class="layout-navbar slide-in-up animated">
            <div class="navbar-content">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Dashboard">
                    <span class="brand-icon">🏛️</span>
                    <span class="brand-text">Civic Connect</span>
                </a>
                <div class="navbar-actions">
                    <div class="navbar-search">
                        <input type="text" placeholder="Search services..." class="search-input">
                        <span class="search-icon">🔍</span>
                    </div>
                    <div class="navbar-notifications">
                        <button class="notification-btn" onclick="showComingSoon('Notifications')">
                            <span class="notification-icon">🔔</span>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    <div class="navbar-menu">
                        <button class="menu-btn" onclick="toggleMenu()">
                            <span class="menu-icon">☰</span>
                        </button>
                        <div class="menu-dropdown" id="menuDropdown">
                            <a href="/Home/Dashboard" class="menu-item">
                                <span class="menu-icon">📊</span>
                                Dashboard
                            </a>
                            <a href="#" class="menu-item" onclick="showComingSoon('Services')">
                                <span class="menu-icon">📋</span>
                                Services
                            </a>
                            <a href="#" class="menu-item" onclick="showComingSoon('Events')">
                                <span class="menu-icon">📅</span>
                                Events
                            </a>
                            <div class="menu-divider"></div>
                            <a href="#" class="menu-item" onclick="showComingSoon('Profile')">
                                <span class="menu-icon">👤</span>
                                My Profile
                            </a>
                            <a href="/Home/Privacy" class="menu-item">
                                <span class="menu-icon">🔒</span>
                                Privacy
                            </a>
                            <a href="#" class="menu-item" onclick="showComingSoon('Settings')">
                                <span class="menu-icon">⚙️</span>
                                Settings
                            </a>
                            <div class="menu-divider"></div>
                            <form id="logoutForm" asp-controller="Account" asp-action="Logout" method="post" style="display:inline;">
                                <button type="submit" class="menu-item menu-item-btn">
                                    <span class="menu-icon">🚪</span>
                                    Logout
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        }
    </header>

    <div class="custom-container">
        <main role="main" class="layout-main">
            @RenderBody()
        </main>
    </div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Anime.js -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" defer></script>

    <!-- AOS JS -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js" defer></script>

    <!-- Animation helper JS -->
    <script src="~/js/Shared/animation-helper.js" defer></script>

    <script>
        // Show coming soon alerts for features under development
        function showComingSoon(feature) {
            alert(`🚧 ${feature} feature coming soon!\n\nThis feature is currently under development and will be available in a future update.`);
        }

        // Toggle menu dropdown
        function toggleMenu() {
            const menuDropdown = document.getElementById('menuDropdown');
            menuDropdown.classList.toggle('show');
        }

        // Add active class to current page nav link
        document.addEventListener('DOMContentLoaded', function () {
            const currentPath = window.location.pathname;
            const menuItems = document.querySelectorAll('.menu-item');

            // Close menu when clicking outside
            document.addEventListener('click', function (event) {
                const menuDropdown = document.getElementById('menuDropdown');
                const menuBtn = document.querySelector('.menu-btn');

                if (menuDropdown && menuBtn && !menuBtn.contains(event.target) && !menuDropdown.contains(event.target)) {
                    menuDropdown.classList.remove('show');
                }
            });

            // Set active menu item based on current page
            menuItems.forEach(item => {
                const href = item.getAttribute('href');
                if (href && currentPath.includes(href) && href !== '/') {
                    item.classList.add('active');
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                    });
                    item.style.pointerEvents = 'none';
                    item.style.opacity = '0.6';
                } else if (href === '/' && currentPath === '/') {
                    item.classList.add('active');
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                    });
                    item.style.pointerEvents = 'none';
                    item.style.opacity = '0.6';
                }
            });
        });

        // Global utility: run callback after page is ready
        window.onPageReady = function(callback) {
            if (window._pageReady || document.body.classList.contains("page-loaded")) {
                callback();
            } else {
                document.addEventListener("pageReady", function handler() {
                    window._pageReady = true;
                    callback();
                    document.removeEventListener("pageReady", handler);
                });
            }
        };
        document.addEventListener("pageReady", function() {
            window._pageReady = true;
        });
    </script>
	@await RenderSectionAsync("Scripts", required: false)
</body>

</html>
